{"ast":null,"code":"import { Conn } from '../conn';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"../accounts.service\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/forms\";\nfunction ManagecategoryComponent_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelement(1, \"br\")(2, \"img\", 13)(3, \"br\");\n    i0.ɵɵelementStart(4, \"input\", 14);\n    i0.ɵɵlistener(\"click\", function ManagecategoryComponent_div_9_Template_input_click_4_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.catupdate());\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"input\", 15);\n    i0.ɵɵlistener(\"click\", function ManagecategoryComponent_div_9_Template_input_click_5_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r5 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r5.oncancel());\n    });\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate1(\"src\", \"uploads/\", ctx_r0.catpic, \"\", i0.ɵɵsanitizeUrl);\n  }\n}\nfunction ManagecategoryComponent_div_10_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\")(1, \"input\", 16);\n    i0.ɵɵlistener(\"click\", function ManagecategoryComponent_div_10_Template_input_click_1_listener() {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r6 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r6.addcategory());\n    });\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction ManagecategoryComponent_tr_34_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r11 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵelement(4, \"img\", 13);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\")(8, \"button\", 17);\n    i0.ɵɵlistener(\"click\", function ManagecategoryComponent_tr_34_Template_button_click_8_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r11);\n      const x_r8 = restoredCtx.$implicit;\n      const ctx_r10 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r10.onupdate(x_r8._id, x_r8.categoryname, x_r8.categorypic));\n    });\n    i0.ɵɵtext(9, \"Update\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(10, \"td\")(11, \"button\", 18);\n    i0.ɵɵlistener(\"click\", function ManagecategoryComponent_tr_34_Template_button_click_11_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r11);\n      const x_r8 = restoredCtx.$implicit;\n      const ctx_r12 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r12.catdelete(x_r8._id));\n    });\n    i0.ɵɵtext(12, \"Delete\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const x_r8 = ctx.$implicit;\n    const i_r9 = ctx.index;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i_r9 + 1);\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate1(\"src\", \"uploads/\", x_r8.categorypic, \"\", i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(x_r8.categoryname);\n  }\n}\nexport let ManagecategoryComponent = /*#__PURE__*/(() => {\n  class ManagecategoryComponent {\n    constructor(myhttp, savecatService, catsrvobj, myrouter) {\n      this.myhttp = myhttp;\n      this.savecatService = savecatService;\n      this.catsrvobj = catsrvobj;\n      this.myrouter = myrouter;\n      this.flag = false;\n    }\n    ngOnInit() {\n      this.fetchcat();\n    }\n    addcategory() {\n      $(\"#mssg\").fadeIn(1000).fadeOut(1000);\n      var mydata = new FormData();\n      //here FormData is a class and we are creating an object of that class\n      //this is used instead of json object bcoz json object can't send binary data \n      mydata.append(\"catname\", this.catname);\n      mydata.append(\"catpic\", this.myfile);\n      //also to send form data containing files we have to change the enc type to multipart/form-data\n      //following is used to check whether we can send binary data into json or not\n      // var databody={\n      //   cname:this.catname,\n      //   picname:this.myfile.name,\n      //   picfile: this.myfile\n      //   //sending whole file\n      // }\n      this.savecatService.savecat2db(mydata).subscribe({\n        next: res => {\n          this.msg = res;\n          // setTimeout(() => { this.myrouter.navigateByUrl('/signup') }, 1000);\n          setTimeout(() => {\n            this.ngOnInit();\n          }, 1500);\n        },\n        error: err => {\n          this.msg = err;\n        }\n      });\n    }\n    fileselected(event) {\n      this.myfile = event.target.files[0];\n      console.log(event);\n    }\n    fetchcat() {\n      this.catsrvobj.fetchallcat().subscribe({\n        next: res => {\n          this.allcatlist = res;\n        },\n        error: err => {\n          this.msg = err;\n        }\n      });\n    }\n    onupdate(cid, cname, cpic) {\n      this.flag = true;\n      this.catname = cname;\n      this.catpic = cpic;\n      this.catid = cid;\n    }\n    oncancel() {\n      this.catname = null;\n      this.flag = false;\n    }\n    catupdate() {\n      var mydata = new FormData();\n      $(\"#mssg\").fadeIn(1000).fadeOut(2500);\n      if (this.myfile != null)\n        // user has chosen new file\n        {\n          mydata.append(\"catname\", this.catname);\n          mydata.append(\"catpic\", this.myfile);\n          mydata.append(\"oldcatpic\", this.catpic); //sent for deletion\n          mydata.append(\"catid\", this.catid);\n        } else {\n        mydata.append(\"catname\", this.catname);\n        mydata.append(\"oldcatpic\", this.catpic); //sent for retaining old name\n        mydata.append(\"catid\", this.catid);\n      }\n      this.catsrvobj.catupdate(mydata).subscribe({\n        next: res => {\n          if (res['nModified'] == 1) {\n            this.msg = \"Category Updated Successfully\";\n          } else {\n            this.msg = \"Category Not Updated Successfully\";\n          }\n        },\n        error: err => {}\n      });\n    }\n    catdelete(catid) {\n      // alert(catid);\n      var confrm = confirm(\"Are you sure want to delete?\");\n      if (confrm) {\n        //note that we get a json object only as a response and not an array of objects\n        this.myhttp.delete(Conn.nodeurl + \"/delcat?catid=\" + catid, {\n          responseType: \"json\"\n        }).subscribe({\n          next: res => {\n            if (res[\"deletedCount\"] == 1) {\n              alert(\"Category Deleted Successfully!\");\n              this.ngOnInit();\n              //this was the best part of todays lecture used to refresh the componenet\n            }\n          },\n\n          error: err => {\n            this.msg = err;\n          }\n        });\n      }\n    }\n  }\n  ManagecategoryComponent.ɵfac = function ManagecategoryComponent_Factory(t) {\n    return new (t || ManagecategoryComponent)(i0.ɵɵdirectiveInject(i1.HttpClient), i0.ɵɵdirectiveInject(i2.AccountsService), i0.ɵɵdirectiveInject(i2.AccountsService), i0.ɵɵdirectiveInject(i3.Router));\n  };\n  ManagecategoryComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ManagecategoryComponent,\n    selectors: [[\"app-managecategory\"]],\n    decls: 35,\n    vars: 5,\n    consts: [[1, \"login\"], [1, \"container\"], [\"data-wow-delay\", \".5s\", 1, \"login-form-grids\", \"animated\", \"wow\", \"slideInUp\"], [\"enctype\", \"multipart/form-data\"], [\"type\", \"text\", \"name\", \"catname\", \"placeholder\", \"Category Name\", 3, \"ngModel\", \"ngModelChange\"], [\"type\", \"file\", \"name\", \"catpic\", 3, \"change\"], [4, \"ngIf\"], [\"id\", \"mssg\"], [1, \"checkout\"], [1, \"w3_agile_header\"], [1, \"table\"], [1, \"timetable_sub\"], [4, \"ngFor\", \"ngForOf\"], [\"height\", \"75\", 3, \"src\"], [\"type\", \"submit\", \"name\", \"b2\", \"value\", \"Update\", 3, \"click\"], [\"type\", \"submit\", \"name\", \"b3\", \"value\", \"Cancel\", 3, \"click\"], [\"type\", \"submit\", \"name\", \"b1\", \"value\", \"Add\", 3, \"click\"], [\"type\", \"button\", 1, \"btn\", \"btn-success\", 3, \"click\"], [\"type\", \"button\", 1, \"btn\", \"btn-danger\", 3, \"click\"]],\n    template: function ManagecategoryComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"h2\");\n        i0.ɵɵtext(3, \"Add Category\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"div\", 2)(5, \"form\", 3)(6, \"input\", 4);\n        i0.ɵɵlistener(\"ngModelChange\", function ManagecategoryComponent_Template_input_ngModelChange_6_listener($event) {\n          return ctx.catname = $event;\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(7, \"br\");\n        i0.ɵɵelementStart(8, \"input\", 5);\n        i0.ɵɵlistener(\"change\", function ManagecategoryComponent_Template_input_change_8_listener($event) {\n          return ctx.fileselected($event);\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(9, ManagecategoryComponent_div_9_Template, 6, 1, \"div\", 6);\n        i0.ɵɵtemplate(10, ManagecategoryComponent_div_10_Template, 2, 0, \"div\", 6);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(11, \"br\");\n        i0.ɵɵelementStart(12, \"p\", 7);\n        i0.ɵɵtext(13);\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(14, \"div\", 8)(15, \"div\", 1)(16, \"h3\", 9);\n        i0.ɵɵtext(17, \"Manage Category \");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(18, \"br\")(19, \"br\");\n        i0.ɵɵelementStart(20, \"div\", 10)(21, \"table\", 11)(22, \"thead\")(23, \"tr\")(24, \"th\");\n        i0.ɵɵtext(25, \"SL No.\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(26, \"th\");\n        i0.ɵɵtext(27, \"Picture\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(28, \"th\");\n        i0.ɵɵtext(29, \"Name\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(30, \"th\");\n        i0.ɵɵtext(31, \"Update\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(32, \"th\");\n        i0.ɵɵtext(33, \"Delete\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵtemplate(34, ManagecategoryComponent_tr_34_Template, 13, 3, \"tr\", 12);\n        i0.ɵɵelementEnd()()()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"ngModel\", ctx.catname);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngIf\", ctx.flag);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.flag);\n        i0.ɵɵadvance(3);\n        i0.ɵɵtextInterpolate(ctx.msg);\n        i0.ɵɵadvance(21);\n        i0.ɵɵproperty(\"ngForOf\", ctx.allcatlist);\n      }\n    },\n    dependencies: [i4.NgForOf, i4.NgIf, i5.ɵNgNoValidate, i5.DefaultValueAccessor, i5.NgControlStatus, i5.NgControlStatusGroup, i5.NgModel, i5.NgForm],\n    styles: [\".table[_ngcontent-%COMP%]{overflow:scroll}\"]\n  });\n  return ManagecategoryComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}